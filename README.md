# YaseaTest
双路推流直播/监控

基本思路：同时预览前后Camera，将预览数据压缩为H264（考虑流量问题），然后推送到rtmp服务器，同时可根据推送地址直接进行拉流观看当前相机的预览（保证推送的url唯一性）

# 项目配置说明
推流框架使用开源项目yasea，见https://github.com/begeekmyfriend/yasea，内部集成了图像空间转换的库与rtmp推送的库

拉流使用b站开源的ijkplayer，见gradle配置文件，另example包封装了b站已写好的自定义播放类实例，可酌情使用。

使用外部项目依赖和gradle集成上述框架

# 难点
同时开启前后Camera预览进行推流将造成两个摄像头的数据混杂在一起，这里使用独立进程（非线程，见AndroidManifest.xml配置）弹出两个悬浮窗来进行预览推流。
个人猜测数据混乱的原因在于多线程的使用造成编码器无法分辨数据来源，而多进程的使用起到了内存空间隔离的作用。

# 注意点
由于上述悬浮窗由service启动和销毁，因此要正确处理悬浮窗的生命周期，强制断电关机可能造成服务器上的数据丢失（推流器未正确关闭造成，但不影响实时观看，只是服务器没有数据保留）。另考虑到该项目的特殊性，要注意service的保活（基本给systemuid即可）

另外由于本项目不带显示屏，需要将系统的默认锁屏方式配置为无

最后，为了防止屏幕熄灭（不带屏幕不代表没有相关状态），可以使用WakeLock使应用持续常亮直到相关上下文销毁

rtmp服务器的配置建议直接搜索下载nginx-rtmp-win32-master，解压后即可使用

# 基本流程
监听广播（开机广播/网络变更）后启动ConnectWifi(IntentService适合执行一定的耗时操作)，根据配置的SSID和密码尝试连接到特定的wifi，成功连网后将参数传到相应的CameraActivity（后期改为直接启动两个进程服务），打开相机后即可自动进行推流
